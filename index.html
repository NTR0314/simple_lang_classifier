<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UKP Project</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
            color: #e0e0e0;
            font-size: 0.9rem;
            padding-top: 2rem;
        }

        main.container {
            max-width: 800px;
        }

        .content-box {
            background-color: #2d2d2d;
            padding: 1.5rem !important;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #f0f0f0;
        }

        .progress {
            height: 18px;
            font-size: 0.75rem;
            background-color: #3a3a3a;
        }

        .progress-bar {
            background-color: #00d4aa;
        }

        #drop-zone {
            border: 1px dashed #555;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            margin-bottom: 15px;
            font-size: 0.85rem;
            background-color: #252525;
            transition: all 0.3s ease;
        }

        #drop-zone.dragover {
            background-color: #3a3a3a;
            border-color: #00d4aa;
        }

        #text-input {
            font-size: 0.9rem;
            min-height: 100px !important;
            background-color: #252525;
            border: 1px solid #444;
            color: #e0e0e0;
        }

        #text-input:focus {
            background-color: #2a2a2a;
            border-color: #00d4aa;
            color: #e0e0e0;
            box-shadow: 0 0 0 0.2rem rgba(0, 212, 170, 0.25);
        }

        #text-input::placeholder {
            color: #888;
        }

        .btn-primary {
            font-size: 0.9rem;
            padding: 0.375rem 1rem;
            background-color: #00d4aa;
            border-color: #00d4aa;
            color: #1a1a1a;
            font-weight: 500;
        }

        .btn-primary:hover {
            background-color: #00b394;
            border-color: #00b394;
            color: #1a1a1a;
        }

        #results {
            margin-top: 1.5rem !important;
        }

        #results h2 {
            font-size: 1.25rem;
            margin-bottom: 1rem;
            color: #f0f0f0;
        }

        .btn-outline-secondary {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            background-color: transparent;
            border: 1px solid #555;
            color: #999;
        }

        .btn-outline-secondary:hover {
            background-color: #3a3a3a;
            border-color: #00d4aa;
            color: #00d4aa;
        }

        .table {
            font-size: 0.85rem;
            color: #e0e0e0;
        }

        .table-striped>tbody>tr:nth-of-type(odd)>* {
            background-color: #2a2a2a;
            color: #f0f0f0;
        }

        .table-striped>tbody>tr:nth-of-type(even)>* {
            background-color: #2d2d2d;
        }

        .table th {
            background-color: #252525;
            color: #00d4aa;
            border-color: #444;
            padding: 0.5rem;
        }

        .table td {
            border-color: #444;
            padding: 0.5rem;
            color: #e0e0e0;
        }

        .mb-3 {
            margin-bottom: 0.75rem !important;
        }

        .text-muted {
            font-size: 0.8rem;
            color: #999 !important;
        }

        #predict-form {
            margin-bottom: 0;
        }

        .table-striped tbody tr {
            height: 35px;
        }

        #drop-zone p {
            margin: 0;
            color: #888;
        }

        .text-danger {
            color: #ff6b6b !important;
        }
    </style>
</head>

<body>
    <main class="container">
        <div class="content-box">
            <h1>UKP Project</h1>

            <div id="drop-zone">
                <p>ðŸ“„ Drag & Drop PDF here</p>
                <input type="file" id="file-input" accept=".pdf" style="display: none;">
                <button type="button" id="file-select-btn" class="btn btn-sm btn-outline-secondary mt-2">Or select
                    file</button>
            </div>

            <form id="predict-form">
                <div class="mb-3">
                    <textarea id="text-input" class="form-control" rows="5" placeholder="Enter text here..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Predict &raquo;</button>
            </form>
        </div>

        <div id="results" class="mt-3" style="display: none;">
            <h2>Results</h2>
            <div id="results-container"></div>
        </div>
    </main>

    <script>
        const dropZone = document.getElementById('drop-zone');
        const textInput = document.getElementById('text-input');
        const resultsDiv = document.getElementById('results');
        const resultsContainer = document.getElementById('results-container');
        const fileInput = document.getElementById('file-input');
        const fileSelectBtn = document.getElementById('file-select-btn');

        // File select button click
        fileSelectBtn.addEventListener('click', () => {
            fileInput.click();
        });

        // File input change
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                handleFileUpload(file);
            } else if (file) {
                alert('Please select a PDF file.');
            }
        });

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                handleFileUpload(file);
            } else {
                alert('Please drop a PDF file.');
            }
        });

        async function handleFileUpload(file) {
            const formData = new FormData();
            formData.append('file', file);

            resultsContainer.innerHTML = '';
            resultsDiv.style.display = 'block';

            const response = await fetch('/uploadfile/', {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            displayResults(data);
        }

        document.getElementById('predict-form').addEventListener('submit', async function (e) {
            e.preventDefault();
            const text = textInput.value;
            resultsContainer.innerHTML = '';
            resultsDiv.style.display = 'block';

            const response = await fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `text=${encodeURIComponent(text)}`
            });

            const data = await response.json();
            displayResults(data);
        });

        function displayResults(data) {
            if (data.top_10_predictions) {
                let html = '';

                // Always show processing info
                const numTexts = data.num_texts_processed || 1;
                const method = data.method_used || 'single text';
                html += `
            <div class="mb-2">
                <small class="text-muted">
                    Processed: ${numTexts} text${numTexts > 1 ? 's' : ''}
                    ${data.method_used ? ` â€¢ Method: ${data.method_used}` : ''}
                </small>
            </div>
        `;

                // Add the results table
                html += '<table class="table table-sm table-striped"><thead><tr><th>Language</th><th>Confidence</th></tr></thead><tbody>';
                data.top_10_predictions.forEach(prediction => {
                    const confidence = (prediction.confidence * 100).toFixed(2);
                    html += `
                <tr>
                    <td>${prediction.language}</td>
                    <td>
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: ${confidence}%;" aria-valuenow="${confidence}" aria-valuemin="0" aria-valuemax="100">${confidence}%</div>
                        </div>
                    </td>
                </tr>
            `;
                });
                html += '</tbody></table>';

                resultsContainer.innerHTML = html;
            } else {
                resultsContainer.innerHTML = '<p class="text-danger">Error: Could not get predictions.</p>';
            }
        }
    </script>
</body>

</html>